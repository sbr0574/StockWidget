# StockWidget

由GPT5协助开发，一个在 **Windows** 上运行的极简透明盯盘Widget浮窗，按指定股票代码实时显示行情表格，可选展示迷你 **K 线**（当天），支持沪深京三市股票。支持拖拽、右键菜单、设置面板、自动保存配置。

> 适合贴在屏幕一角随时查看 👀

---

## ✨ 功能概览

* **透明无框浮窗**：置顶显示，拖拽任意区域即可移动，**双击**浮窗可隐藏，右键展示设置菜单。
* **系统托盘**：左键切换显示/隐藏；右键菜单含“设置 / 退出”。
* **表格展示**（可选列）：`名称 | 现价（默认） | 涨跌值 | 涨跌幅（默认） | 均价/封单 | 委比 | K线`

  * **涨跌停板时，均价自动切换为封单数量**
  * **现价触及当日最高/最低**时显示 `↑ / ↓`
* **默认颜色**：开启后自动 **红涨绿跌**；关闭则为 **单色模式**（按自定义的文字颜色）。
* **列开关与表头显示**：右键浮窗 → “显示列”“显示表头”即时生效。
* **字体与行距**：字号 **8–15 pt**；行距为额外像素（行高 = 字高 + 行距），**K 线尺寸随字号同步缩放**。
* **刷新间隔**：可选 1/2/3/5/10/15/30/60 秒。
* **股票代码管理**：设置面板内用列表**增/删/改/上移/下移**，自动**规格化**代码格式并去重（例：`600000`→`sh600000`，`000001`→`sz000001`）。
* **自动保存**：所有设置即时保存至配置文件（`C:\Users\用户\APPDATA\Roaming\StockWidget\SW_config.json`）；浮窗隐藏时**暂停刷新**，显示时自动恢复。

---

## 🖼️ 界面一览

* 极简显示
> <img width="375" height="141" alt="image" src="https://github.com/user-attachments/assets/e3629ada-5a07-495a-a263-d1479a74a1df" />
* 设置页面
> <img width="782" height="488" alt="image" src="https://github.com/user-attachments/assets/e0a97961-045a-4e6f-bac8-357756a0c018" />
* 显示全部指标+默认颜色
> <img width="385" height="117" alt="image" src="https://github.com/user-attachments/assets/e82c38e2-1fe6-4b97-b915-4f2240d2a7bd" />


* 浮窗**背景可透明**，且可单独设置**整体不透明度**。

---

## 🧰 运行环境

右侧Releases已有打包好的程序，**可直接下载使用**

若要通过代码脚本形式运行，则需要：
* Windows 10/11
* Python **3.13**（其他 3.x 通常也可）
* 依赖：

  * `PySide6`（界面）
  * `requests`（拉取行情）

```powershell
pip install PySide6 requests
# 打包需要
pip install pyinstaller
```

---

## ▶️ 运行 & 打包

### 运行

```powershell
python .\StockWidget.py
```

### 打包成.exe

```powershell
python3 -m PyInstaller -F -w .\StockWidget.py --name StockWidget --icon .\StockWidget.ico --add-data ".\StockWidget.ico;."
```

> 提示 `No module named 'PIL'`：请先 `pip install Pillow`。
> 任务栏/任务管理器图标不生效：
>
> * 运行时图标由 `app.setWindowIcon(QIcon("StockWidget.ico"))` 提供；
> * EXE 图标由 `--icon` 提供；
> * 某些情况下需要**重启资源管理器**（任务管理器 → Windows 资源管理器 → 重新启动）。

---

## ⚙️ 设置面板

* **股票代码**：列表自由增删改，支持**上移/下移**。
  编辑规则（自动规格化并去重）：

  * `sh|sz|bj` + 数字 → 直接接受（例：`sh600000`）
  * `6`、`90`、`5` 开头 → `sh`（例：`600000`→`sh600000`）
  * `0`、`1`、`2`、`3` 开头 → `sz`
  * `4`、`8`、`92` 开头 → `bj`
  * 不符合规则的输入会回退到上次有效值
* **刷新间隔**：1–60 秒预设值，不建议小于1秒
* **颜色与透明度**：

  * **默认颜色**（红涨绿跌）
  * 文本颜色（默认颜色关闭时可选）
  * 背景颜色、背景不透明度（0–100%）
  * 整体不透明度（20–100%）
* **字体与行距**：

  * 字体
  * 字号（8–15 pt）
  * 行距

> 修改**实时生效**。

---

## 🖱️ 操作速览

* **拖动窗口**：按住窗口任意位置拖动。
* **双击浮窗**：隐藏。
* **右键浮窗**：显示列 / 显示表头 / 默认颜色 / 设置… / 隐藏浮窗。
* **系统托盘**：

  * 左键：显示/隐藏浮窗
  * 右键：设置… / 退出

---

## 🌐 数据来源 & 网络

* 行情通过 `requests` 从 **新浪财经**接口（`hq.sinajs.cn`）获取。
* 程序仅发起 GET 请求，不包含任何账户/交易操作；请根据自身网络环境决定是否使用代理或更换数据源。
* 浮窗隐藏时会暂停刷新，显示后自动恢复，减少不必要的请求。

---

## 📜 许可

* 个人/学习用途自由使用；涉及第三方数据源时请遵守其使用条款。

---
